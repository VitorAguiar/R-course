---
title: "creating R packages"
author: "Vitor Aguiar"
date: "December 3, 2015"
output: ioslides_presentation
---

## Packages

- fundamental units of shareable R code
- reusable R functions
- documentation
- make ease for your colleagues to use your code
- release package with your paper: reproducibility!

---

*"Seriously, it doesn’t have to be about sharing your code (although that is an added benefit!). It is about saving yourself time."*

> --<cite>Hillary Parker</cite>

## devtools package

*"The goal of devtools is to make package development as painless as possible.[...] You can focus on the problem you’re interested in, not on developing a package."*

> --<cite>Hadley Wickham</cite>

## package structure

```{r engine='bash'}
tree ~/coursetest
```

---

- `R/` is where your R code lives

- `DESCRIPTION` describes what the package does, what it needs to work, the license, how to contact the authors, etc.

--- 

```
Package: coursetest
Title: What the Package Does (one line, title case)
Version: 0.0.0.9000
Authors@R: person("First", "Last", email = "first.last@example.com", 
                  role = c("aut", "cre"))
Description: What the package does (one paragraph).
Depends: R (>= 3.2.1)
License: What license is it under?
LazyData: true
```

---

- `man` is where the documentation of your functions is saved. Documentation is easily generated by roxygen2

- `NAMESPACE` describes what functions your package makes available to other packages and what functions it requires from other packages. Also generated by roxygen2.

- `data/` allows you to add data to your package

- `data-raw/` is where you put the code you used to generate the data in data/

## Getting started

- follow the [instructions on how to start the package directory and add git control to it](https://github.com/VitorAguiar/R-course/blob/master/git.md).

- check that you have everything you need to develop a package:

```{r eval=FALSE}
library(devtools)

has_devel()
```

Does this command return TRUE at the end?

# purpose

---

The packages will create in this course are not intended to be sent to CRAN. Instead, we'll keep it on GitHub only. 
The packages will be ready to be installed by everyone and will contain documentation, as any package on CRAN.

---

In Rstudio, open the .Rproj file in your package directory

Then open the hello.R file in R/

---

```
# Hello, world!
#
# This is an example function named 'hello' 
# which prints 'Hello, world!'.
#
# You can learn more about package authoring with RStudio at:
#
#   http://r-pkgs.had.co.nz/
#
# Some useful keyboard shortcuts for package authoring:
#
#   Build and Reload Package:  'Cmd + Shift + B'
#   Check Package:             'Cmd + Shift + E'
#   Test Package:              'Cmd + Shift + T'

hello <- function() {
  print("Hello, world!")
  }
```

---

Let's add a function to R/

---

```
#' Return the object taken as input
#'
#' @param character string. Object to be returned.
#'
#' @return Returns object taken as input without modifying any attribute.
#'
#' @export

return_equal <- function(x) {
  return(x)
}
```

---

`#'` indicates to roxygen2 that this is a function documentation instead of
regular R comments

`@param` is a tag used to describe your function's arguments

`@return` is a tag used to describe the object returned by your function

`@export` is a tag that indicates to roxygen2 that you want your function to be
exported, i.e. you want it to be available to the user once it attaches your
package.

---

Now, run this command in R to generate the documentation:

```{r eval=FALSE}
document()
```

load your package with:

```{r eval=FALSE}
load_all("PathToPackage")
```

And test the documentation of your function:

```{r eval=FALSE}
?return_equal
```

---

go to the Git pane in Rstudio:

- stage all files
- commit
